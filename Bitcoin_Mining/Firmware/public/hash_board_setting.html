<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .btn-fixed { width:80px; text-align:center; }
    .input-group > .form-control[readonly] {background:#e9ecef;}
  </style>
</head>
<body class="p-3">
  <h4>Hash Board Setting</h4>

  <!-- Frequency -->
  <label class="mt-3 mb-2">Set Frequency (MHz for all ASICs):</label>
  <div class="input-group mb-4">
    <input type="number" id="freqInput" class="form-control" value="100" placeholder="MHz 25~150" />
    <button class="btn btn-primary btn-fixed" onclick="setFrequency()">Set</button>
    <input type="text" id="freqCurrent" class="form-control" readonly placeholder="Current MHz" />
    <button class="btn btn-secondary btn-fixed" onclick="readFrequency()">Read</button>
  </div>

  <!-- Base Nonce -->
  <label class="mt-3 mb-2">Base Nonce (hex 32-bit each ASIC):</label>
  <div class="input-group mb-2">
    <input type="text" id="bn1Input" class="form-control" value="0x00000000" />
    <input type="text" id="bn2Input" class="form-control" value="0x55555556" />
    <input type="text" id="bn3Input" class="form-control" value="0xAAAAAAAC" />
    <button class="btn btn-primary btn-fixed" onclick="setBaseNonce()">Set</button>
  </div>
  <div class="input-group mb-4">
    <input type="text" id="bn1Current" class="form-control" readonly placeholder="Current ASIC1" />
    <input type="text" id="bn2Current" class="form-control" readonly placeholder="Current ASIC2" />
    <input type="text" id="bn3Current" class="form-control" readonly placeholder="Current ASIC3" />
    <button class="btn btn-secondary btn-fixed" onclick="readBaseNonce()">Read</button>
  </div>

  <!-- Range Nonce -->
  <label class="mt-3 mb-2">
    Range Nonce (hex 32-bit for one SHA-256d Core, set for all cores in all 3 ASIC chips):
  </label>
  <div class="input-group mb-2">
    <input type="text" id="rangeNonceInput" class="form-control" value="0x2AAAAAAB" />
    <button class="btn btn-primary btn-fixed" onclick="setRangeNonce()">Set</button>
  </div>
  <div class="input-group mb-3">
    <input type="text" id="rangeNonceCurrent" class="form-control" readonly placeholder="Current Range" />
    <button class="btn btn-secondary btn-fixed" onclick="readRangeNonce()">Read</button>
  </div>

  <!-- Extra buttons -->
  <div class="mt-4">
    <button class="btn btn-success me-2" onclick="setAll()">Set All</button>
    <button class="btn btn-info" onclick="readAll()">Read All</button>
  </div>

  <div class="mt-3 text-success" id="cfgResult"></div>

<script>
function isHex32(v){ return /^0x[0-9a-fA-F]{1,8}$/.test(v); }

function setFrequency(){
  const freq = document.getElementById('freqInput').value.trim();
  fetch('/api/set_frequency',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({frequency:freq})})
    .then(r=>r.text()).then(t=>{document.getElementById('cfgResult').innerText=t;});
}
function readFrequency(){
  fetch('/api/read_frequency',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({asic:0})})
    .then(r=>r.text()).then(t=>{document.getElementById('freqCurrent').value=t;});
}

function setBaseNonce(){
  const vals = [bn1Input.value.trim(), bn2Input.value.trim(), bn3Input.value.trim()];
  if(!vals.every(v=>isHex32(v))){ alert('Invalid 32-bit Hex'); return; }
  vals.forEach((v,i)=>{
    fetch('/api/set_base_nonce',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({asic:i,value:v})})
      .then(r=>r.text()).then(t=>{document.getElementById('cfgResult').innerText=t;});
  });
}
function readBaseNonce(){
  [0,1,2].forEach(i=>{
    fetch('/api/read_base_nonce',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({asic:i})})
      .then(r=>r.text()).then(t=>{
        document.getElementById(`bn${i+1}Current`).value=t;
      });
  });
}

function setRangeNonce(){
  const v = rangeNonceInput.value.trim();
  if(!isHex32(v)){ alert('Invalid 32-bit Hex'); return; }
  fetch('/api/set_range_nonce',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({value:v})})
    .then(r=>r.text()).then(t=>{document.getElementById('cfgResult').innerText=t;});
}
function readRangeNonce(){
  fetch('/api/read_range_nonce',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({asic:0})})
    .then(r=>r.text()).then(t=>{document.getElementById('rangeNonceCurrent').value=t;});
}

function setAll(){ setFrequency(); setBaseNonce(); setRangeNonce(); }
function readAll(){ readFrequency(); readBaseNonce(); readRangeNonce(); }
</script>
</body>
</html>
